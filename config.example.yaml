# çˆ¬è™« + AI è¯„çº§ç³»ç»Ÿé…ç½®æ–‡ä»¶
# æ‰€æœ‰é…ç½®é‡‡ç”¨å£°æ˜å¼å®šä¹‰ï¼Œæ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–

# ============ æ•°æ®æºé…ç½® ============
scraper:
  # å¯ç”¨çš„æ•°æ®æº
  sources:
    - name: google_maps
      enabled: true
      adapter: GoogleMapsAdapter
      rate_limit: 100/hour  # æ¯å°æ—¶æœ€å¤š 100 æ¬¡è¯·æ±‚
      priority: 5           # ä¼˜å…ˆçº§ 1-10
      config:
        headless: true
        timeout: 30000      # 30 ç§’è¶…æ—¶
        # åœ°ç†ä½ç½®æœç´¢é…ç½® (å¯é€‰ï¼Œå¦‚æœä¸è®¾ç½®åˆ™ä½¿ç”¨æ™®é€šå…³é”®è¯æœç´¢)
        geolocation:
          # === æ–¹å¼1: ä½¿ç”¨é¢„å®šä¹‰åŸå¸‚ (æ¨è) ===
          city: "åŒ—äº¬"         # æ”¯æŒï¼šåŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·ã€æ·±åœ³ã€æ­å·ã€æˆéƒ½ç­‰
          zoom: 15            # ç¼©æ”¾çº§åˆ« (1-21)
          step: 0.02          # ç½‘æ ¼æ­¥é•¿ï¼Œçº¦2kmï¼Œå€¼è¶Šå°è¦†ç›–è¶Šå¯†é›†ä½†è€—æ—¶è¶Šé•¿
          
          # === æ–¹å¼2: æ‰‹åŠ¨æŒ‡å®šä¸­å¿ƒç‚¹å’ŒåŠå¾„ ===
          # latitude: 39.9042
          # longitude: 116.4074
          # radius: 0.2        # æœç´¢åŠå¾„(åº¦)ï¼Œçº¦22km
          # zoom: 15
          # step: 0.01
          
          # === æ–¹å¼3: æ‰‹åŠ¨æŒ‡å®šçŸ©å½¢è¾¹ç•Œ ===
          # bounds:
          #   north: 40.2
          #   south: 39.6
          #   east: 116.8
          #   west: 115.9
          # zoom: 15
          # step: 0.01
        
    - name: linkedin
      enabled: false
      adapter: LinkedInAdapter
      rate_limit: 50/hour
      priority: 8
      config:
        require_login: true
        cookies_file: ./cookies/linkedin.json
        
    - name: qichacha
      enabled: true
      adapter: QichachaAdapter
      rate_limit: 200/hour
      priority: 6
      config:
        api_key: ${QICHACHA_API_KEY}
        
  # åçˆ¬ç­–ç•¥
  anti_scraping:
    # ä»£ç†æ± 
    proxy:
      enabled: true
      provider: bright_data  # bright_data | oxylabs | custom
      config:
        username: ${PROXY_USERNAME}
        password: ${PROXY_PASSWORD}
        endpoint: brd.superproxy.io:33335
        
    # è¯·æ±‚é—´éš”
    delay:
      min: 1000   # æœ€å° 1 ç§’
      max: 5000   # æœ€å¤§ 5 ç§’
      
    # æµè§ˆå™¨æŒ‡çº¹ä¼ªè£…
    stealth:
      enabled: true
      randomize_viewport: true
      randomize_user_agent: true

# ============ æ•°æ®å¤„ç†é…ç½® ============
processor:
  # å¤„ç†ç®¡é“ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰
  pipeline:
    - name: HtmlCleaner
      enabled: true
      
    - name: TextNormalizer
      enabled: true
      
    - name: ContactExtractor
      enabled: true
      config:
        extract_email: true
        extract_phone: true
        
    - name: DomainDeduplicator
      enabled: true
      config:
        ttl: 604800  # å»é‡ç¼“å­˜ 7 å¤©
        
    - name: TokenEstimator
      enabled: true
      config:
        model: gpt-4o
  
  # å»é‡ç­–ç•¥
  deduplication:
    strategy: multi_level  # bloom_filter | exact | multi_level
    keys:
      - domain
      - usci  # ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç 
      - company_name_region_hash

# ============ AI è¯„çº§é…ç½® ============
rating:
  # LLM è®¾ç½®
  llm:
    provider: openai  # openai | anthropic
    model: gpt-4o
    fallback_model: gpt-4o-mini  # é™çº§æ¨¡å‹
    temperature: 0.3
    max_tokens: 1000
    
  # æ‰¹é‡å¤„ç†
  batch:
    enabled: true
    size: 5  # æ¯æ‰¹ 5 å®¶å…¬å¸
    
  # Token ä¼˜åŒ–
  optimization:
    cache_similar: true
    max_description_length: 500
    max_job_postings: 5
    max_news: 3
    
  # è¯„åˆ†ç»´åº¦
  dimensions:
    - name: firmographics
      display_name: åŸºç¡€åŒ¹é…åº¦
      weight: 0.3
      max_score: 3
      rules:
        - condition: industry in ['ç”µå•†', 'ç‰©æµ', 'é‡‘è', 'SaaS']
          score: 3
          reason: å±äºç›®æ ‡è¡Œä¸š
          
        - condition: estimated_size == 'large'
          score: 2
          reason: ä¼ä¸šè§„æ¨¡è¾¾æ ‡
          
        - condition: estimated_size == 'small'
          score: -5
          reason: è§„æ¨¡è¿‡å°ï¼Œå®¢å•ä»·ä½
          
    - name: intent_signals
      display_name: æ„å‘ä¿¡å·
      weight: 0.4
      max_score: 4
      rules:
        - condition: has_job_posting(['å®¢æœ', 'å”®å', 'Customer Service'])
          score: 3
          reason: æ­£åœ¨æ‹›è˜ç›¸å…³å²—ä½
          
        - condition: recent_funding_within_months(6)
          score: 1
          reason: è¿‘æœŸè·å¾—èèµ„
          
        - condition: mentioned_pain_point(['æ•ˆç‡', 'æˆæœ¬', 'è‡ªåŠ¨åŒ–'])
          score: 1
          reason: ç¤¾äº¤åª’ä½“æåŠç—›ç‚¹
          
    - name: pain_points
      display_name: ç—›ç‚¹å…³è”åº¦
      weight: 0.3
      max_score: 3
      rules:
        - condition: legacy_tech_stack()
          score: 1.5
          reason: æŠ€æœ¯æ ˆè½å
          
        - condition: slow_growth()
          score: 1.5
          reason: ç”¨æˆ·å¢é•¿ç¼“æ…¢
  
  # è¯„åˆ†é˜ˆå€¼
  thresholds:
    high: 9      # >= 9 åˆ†ä¸ºé«˜ä¼˜
    medium: 6    # 6-8 åˆ†ä¸ºä¸­ä¼˜
    low: 6       # < 6 åˆ†ä¸ºä½ä¼˜
    
  # äº§å“ä¿¡æ¯ï¼ˆç”¨äº Promptï¼‰
  product:
    name: å…¨è‡ªåŠ¨AIå®¢æœç³»ç»Ÿ
    description: |
      å¸®åŠ©ä¼ä¸šå®ç°å®¢æœè‡ªåŠ¨åŒ–ï¼Œé€šè¿‡ AI æŠ€æœ¯å‡å°‘ 80% äººåŠ›æˆæœ¬ï¼Œ
      æ–°å‘˜å·¥ 3 å¤©å³å¯ä¸Šå²—ï¼Œæ”¯æŒå¤šæ¸ é“æ¥å…¥ï¼ˆç½‘é¡µã€å¾®ä¿¡ã€APPï¼‰ã€‚
    target_industries:
      - ç”µå•†
      - ç‰©æµ
      - é‡‘è
      - åœ¨çº¿æ•™è‚²
    target_size: medium,large
    target_regions:
      - åŒ—äº¬
      - ä¸Šæµ·
      - æ·±åœ³
      - æ­å·

# ============ è‡ªåŠ¨åŒ–æµè½¬é…ç½® ============
automation:
  # è·¯ç”±è§„åˆ™ï¼ˆæŒ‰ä¼˜å…ˆçº§æ‰§è¡Œï¼‰
  rules:
    - name: é«˜ä¼˜çº¿ç´¢ï¼ˆ9-10åˆ†ï¼‰
      priority: 1
      condition: score >= 9
      actions:
        - type: notify
          channels:
            - wechat
            - dingtalk
            
        - type: generate_email
          template: personalized_outreach
          
        - type: crm_push
          priority: high
          stage: qualified_lead
          owner: auto_assign
          
    - name: ä¸­ä¼˜çº¿ç´¢ï¼ˆ6-8åˆ†ï¼‰
      priority: 2
      condition: score >= 6 and score < 9
      actions:
        - type: email_sequence
          campaign: nurture_6month
          
        - type: crm_push
          priority: medium
          stage: lead
          
    - name: ä½åˆ†çº¿ç´¢ï¼ˆ<6åˆ†ï¼‰
      priority: 3
      condition: score < 6
      actions:
        - type: archive
          reason: low_score
          
    # ç‰¹æ®Šè§„åˆ™
    - name: æ‹›è˜ä¿¡å·å¼ºçƒˆ
      priority: 0  # æœ€é«˜ä¼˜å…ˆçº§
      condition: intent_signals >= 3 and job_postings_count > 2
      actions:
        - type: notify
          channels:
            - wechat
          message_template: |
            ğŸ”¥ æ‹›è˜ä¿¡å·å¼ºçƒˆï¼
            å…¬å¸ {{company_name}} æ­£åœ¨å¤§é‡æ‹›è˜å®¢æœå²—ä½ï¼ˆ{{job_count}}ä¸ªï¼‰ï¼Œ
            å»ºè®®ç«‹å³è·Ÿè¿›ã€‚
            
        - type: crm_push
          priority: urgent
          stage: hot_lead

# ============ é›†æˆæœåŠ¡é…ç½® ============
integrations:
  # CRM
  crm:
    provider: hubspot  # hubspot | salesforce | custom
    config:
      api_key: ${HUBSPOT_API_KEY}
      default_owner_id: ${HUBSPOT_DEFAULT_OWNER}
      custom_fields:
        ai_rating_score: ai_rating_score
        ai_rating_confidence: ai_rating_confidence
        ai_icebreaker: ai_icebreaker
        
  # é€šçŸ¥æœåŠ¡
  notifications:
    wechat:
      enabled: true
      webhook_url: ${WECHAT_WEBHOOK_URL}
      
    dingtalk:
      enabled: true
      webhook_url: ${DINGTALK_WEBHOOK_URL}
      secret: ${DINGTALK_SECRET}
      
    email:
      enabled: true
      smtp:
        host: smtp.gmail.com
        port: 587
        secure: false
        auth:
          user: ${EMAIL_USER}
          pass: ${EMAIL_PASS}
      from: sales@example.com
      to:
        - sales-team@example.com
        
  # é‚®ä»¶è¥é”€
  email_marketing:
    provider: mailchimp  # mailchimp | sendgrid | custom
    config:
      api_key: ${MAILCHIMP_API_KEY}
      audience_id: ${MAILCHIMP_AUDIENCE_ID}
      campaigns:
        nurture_6month:
          id: campaign_123
          tags:
            - medium_priority
            - auto_generated

# ============ æ•°æ®åº“é…ç½® ============
database:
  postgres:
    host: ${POSTGRES_HOST:-localhost}
    port: ${POSTGRES_PORT:-5432}
    database: ${POSTGRES_DB:-lead_rating}
    username: ${POSTGRES_USER:-postgres}
    password: ${POSTGRES_PASSWORD}
    pool:
      min: 2
      max: 10
      
  redis:
    host: ${REDIS_HOST:-localhost}
    port: ${REDIS_PORT:-6379}
    password: ${REDIS_PASSWORD}
    db: 0
    
  # å¯¹è±¡å­˜å‚¨ï¼ˆå­˜å‚¨åŸå§‹ HTMLã€æˆªå›¾ï¼‰
  storage:
    provider: minio  # minio | s3
    config:
      endpoint: ${MINIO_ENDPOINT:-localhost:9000}
      access_key: ${MINIO_ACCESS_KEY}
      secret_key: ${MINIO_SECRET_KEY}
      bucket: lead-scraper-raw-data
      use_ssl: false

# ============ ä»»åŠ¡é˜Ÿåˆ—é…ç½® ============
queue:
  # BullMQ é…ç½®
  bullmq:
    connection:
      host: ${REDIS_HOST:-localhost}
      port: ${REDIS_PORT:-6379}
      
  # å„é˜Ÿåˆ—é…ç½®
  queues:
    scrape:
      concurrency: 5
      rate_limit:
        max: 100
        duration: 60000  # 1 åˆ†é’Ÿ
      retry:
        attempts: 3
        backoff:
          type: exponential
          delay: 5000
          
    process:
      concurrency: 10
      rate_limit:
        max: 500
        duration: 60000
        
    rating:
      concurrency: 3   # æ§åˆ¶ AI API å¹¶å‘
      rate_limit:
        max: 60
        duration: 60000
      retry:
        attempts: 5
        backoff:
          type: exponential
          delay: 10000
          
    automation:
      concurrency: 5
      rate_limit:
        max: 200
        duration: 60000

# ============ ç›‘æ§ä¸æ—¥å¿— ============
monitoring:
  # æ—¥å¿—
  logging:
    level: info  # debug | info | warn | error
    format: json
    outputs:
      - console
      - file
    file:
      path: ./logs/app.log
      max_size: 100mb
      max_files: 10
      
  # æŒ‡æ ‡
  metrics:
    enabled: true
    provider: prometheus
    port: 9090
    
  # è¿½è¸ª
  tracing:
    enabled: false
    provider: opentelemetry
    
  # å‘Šè­¦
  alerts:
    enabled: true
    channels:
      - type: webhook
        url: ${ALERT_WEBHOOK_URL}
    rules:
      - name: çˆ¬è™«å¤±è´¥ç‡è¿‡é«˜
        condition: scrape_error_rate > 0.3
        message: çˆ¬è™«å¤±è´¥ç‡è¶…è¿‡ 30%
        
      - name: AI API æˆæœ¬è¶…é¢„ç®—
        condition: daily_ai_cost > 200
        message: ä»Šæ—¥ AI API æˆæœ¬è¶…è¿‡ $200

# ============ å¼€å‘ä¸éƒ¨ç½² ============
environment: development  # development | staging | production

# å®šæ—¶ä»»åŠ¡
cron:
  - name: daily_scrape
    schedule: "0 9 * * *"  # æ¯å¤© 9:00
    timezone: Asia/Shanghai
    task: scrape
    params:
      source: google_maps
      query: åŒ—äº¬ è½¯ä»¶å…¬å¸
      limit: 50
      
  - name: weekly_report
    schedule: "0 18 * * 5"  # æ¯å‘¨äº” 18:00
    timezone: Asia/Shanghai
    task: generate_report
